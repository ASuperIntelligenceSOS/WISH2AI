<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WISH2AI</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* [Previous CSS remains the same] */
        .payment-methods {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .payment-btn {
            background: #222;
            color: white;
            padding: 10px 20px;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- [Previous HTML content remains the same until the form] -->

    <form id="wishForm">
        <textarea id="wish" placeholder="Écrivez votre vœu ici (25 caractères max)" maxlength="25"></textarea>
        <input type="email" id="email" placeholder="Email (facultatif)">
        
        <div class="payment-methods">
            <button type="button" class="payment-btn" onclick="handlePayment('card')">Carte bancaire</button>
            <button type="button" class="payment-btn" onclick="handlePayment('apple')">Apple Pay</button>
            <button type="button" class="payment-btn" onclick="handlePayment('google')">Google Pay</button>
        </div>

        <button type="submit">Envoyer mon vœu</button>
    </form>

    <!-- [Rest of the HTML remains the same] -->

    <script>
        const stripe = Stripe('votre_cle_publique_stripe');

        const plans = {
            'free': { price: 0 },
            'basic': { price: 100 }, // 1€ en centimes
            'priority': { price: 500 }, // 5€ en centimes
            'premium': { price: 1000 } // 10€ en centimes
        };

        let selectedPlan = 'free';

        async function handlePayment(method) {
            if (selectedPlan === 'free') {
                alert('Le premier vœu est gratuit !');
                return;
            }

            try {
                const response = await fetch('/create-payment-intent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: plans[selectedPlan].price,
                        payment_method: method
                    })
                });

                const data = await response.json();
                
                const result = await stripe.confirmCardPayment(data.clientSecret, {
                    payment_method: {
                        card: elements.getElement('card'),
                        billing_details: {
                            email: document.getElementById('email').value
                        }
                    }
                });

                if (result.error) {
                    alert('Erreur de paiement: ' + result.error.message);
                } else {
                    document.getElementById('wishForm').submit();
                }
            } catch (error) {
                alert('Erreur: ' + error.message);
            }
        }

        // [Previous JavaScript code remains the same]
    </script>
</body>
</html> 
